<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DualPay Calculator 2029LN</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
body { 
    font-family: 'Montserrat', sans-serif;
    background: #0B3D91; /* тъмно морско синьо */
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}
.calculator {
    backdrop-filter: blur(20px);
    background: rgba(255,255,255,0.3);
    border-radius: 1.5rem;
    box-shadow: 0 15px 40px rgba(0,0,0,0.35);
    padding: 3rem;
    width: 95%;
    max-width: 500px;
    position: relative;
    overflow: hidden;
}
h1 { font-family: 'Comfortaa', cursive; text-align:center; margin-bottom:1.5rem; color:#FFD700; font-size:2rem; }
input, select {
    width:100%;
    padding:0.75rem;
    margin-top:0.25rem;
    margin-bottom:0.9rem;
    border-radius:0.75rem;
    border:1px solid #ccc;
    background:#A0E7E5; /* много светло тюркоаз */
}
button {
    width:100%;
    padding:0.85rem;
    background:#FF7F50; /* ярко оранжево */
    color:white;
    font-weight:600;
    border:none;
    border-radius:0.75rem;
    cursor:pointer;
    margin-top:0.7rem;
    transition: background 0.2s;
    font-size:1.05rem;
}
button:hover { background:#e76f42; }
#result {
    margin-top:1.2rem;
    padding:0.6rem;
    font-weight:600;
    text-align:center;
    transition: all 0.3s ease;
    font-size:1.05rem;
}
.float-symbol {
    position:absolute;
    font-size:1.7rem;
    opacity:0.08;
    animation: float 12s linear infinite;
}
@keyframes float {
    0% { transform: translate(0,0) rotate(0deg) scale(1);}
    50% { transform: translate(20px,20px) rotate(25deg) scale(1.3);}
    100% { transform: translate(0,0) rotate(0deg) scale(1);}
}
footer {
    margin-top:1.5rem;
    font-size:0.9rem;
    text-align:center;
    color:#FFD700;
    font-family:'Montserrat',sans-serif;
}
</style>
</head>
<body>

<div class="calculator">
    <h1>DualPay Calculator</h1>

    <label>Сума за плащане:
        <input type="number" id="dueAmount" placeholder="Сума" step="0.01">
    </label>
    <label>Валута:
        <select id="dueCurrency">
            <option value="BGN">BGN</option>
            <option value="EUR">EUR</option>
        </select>
    </label>

    <label>Платено в лв:
        <input type="number" id="paidBGN" placeholder="Лева" step="0.01">
    </label>
    <label>Платено в €:
        <input type="number" id="paidEUR" placeholder="Евро" step="0.01">
    </label>

    <button id="calculate">Изчисли ресто</button>
    <div id="result"></div>
</div>

<footer>Курс: 1 EUR = 1.95583 BGN | © M</footer>

<script>
const FIXED_RATE = 1.95583;
const resultDiv = document.getElementById('result');

function calculateChange() {
    const dueAmount = parseFloat(document.getElementById('dueAmount').value) || 0;
    const dueCurrency = document.getElementById('dueCurrency').value;
    const paidBGN = parseFloat(document.getElementById('paidBGN').value) || 0;
    const paidEUR = parseFloat(document.getElementById('paidEUR').value) || 0;

    let dueInEUR = dueCurrency === "BGN" ? dueAmount / FIXED_RATE : dueAmount;
    let totalPaidEUR = paidEUR + (paidBGN / FIXED_RATE);
    let changeEUR = totalPaidEUR - dueInEUR;

    if (changeEUR < 0) {
        resultDiv.style.color = 'red';
        resultDiv.textContent = "Недостатъчно платено!";
        return;
    }
    resultDiv.style.color = '#FFD700';
    let changeBGN = changeEUR * FIXED_RATE;
    resultDiv.textContent = `Ресто: ${changeEUR.toFixed(2)} EUR (${changeBGN.toFixed(2)} BGN)`;
}

document.getElementById('calculate').addEventListener('click', calculateChange);

// Динамичен фон с float символи
const symbols = ['€','лв'];
for(let i=0;i<30;i++){
    let span=document.createElement('span');
    span.className='float-symbol';
    span.textContent=symbols[i%2];
    span.style.left=Math.random()*100+'%';
    span.style.top=Math.random()*100+'%';
    span.style.animationDuration=(6+Math.random()*12)+'s';
    span.style.fontSize=(14+Math.random()*22)+'px';
    document.querySelector('.calculator').appendChild(span);
}

// Canvas икона
const canvas=document.createElement('canvas');
canvas.width=512; canvas.height=512;
const ctx=canvas.getContext('2d');
ctx.fillStyle="#40E0D0"; /* тюркоазово */
ctx.fillRect(0,0,512,512);
ctx.fillStyle="white";
ctx.font="bold 100px Comfortaa";
ctx.textAlign="center"; ctx.textBaseline="middle";
ctx.fillText("€ ⇄ лв",256,256);
const iconURL=canvas.toDataURL();
const link=document.createElement('link');
link.rel='icon'; link.href=iconURL;
document.head.appendChild(link);

// PWA Manifest и Service Worker
const manifest = {
    name:"DualPay Calculator 2029LN",
    short_name:"DualPay",
    start_url:".",
    display:"standalone",
    background_color:"#0B3D91",
    theme_color:"#FF7F50",
    icons:[
        {src:iconURL,sizes:"512x512",type:"image/png"}
    ]
};
const manifestBlob = new Blob([JSON.stringify(manifest)],{type:'application/json'});
const manifestURL = URL.createObjectURL(manifestBlob);
const manifestLink = document.createElement('link');
manifestLink.rel='manifest'; manifestLink.href=manifestURL;
document.head.appendChild(manifestLink);

if('serviceWorker' in navigator){
    const swCode = `
    self.addEventListener('install', e=>{ e.waitUntil(caches.open('dualpay-cache').then(cache=>cache.addAll(['/']))); });
    self.addEventListener('fetch', e=>{ e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))); });
    `;
    const swBlob = new Blob([swCode],{type:'application/javascript'});
    const swURL = URL.createObjectURL(swBlob);
    navigator.serviceWorker.register(swURL);
}
</script>

</body>
</html>
